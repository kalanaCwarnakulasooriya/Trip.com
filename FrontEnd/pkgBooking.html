<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip.com - Book Your Dream Vacation</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="css/pkgBooking.css">
    <link rel="stylesheet" href="css/toastr.css">
    <script src="https://unpkg.com/scrollreveal"></script>
</head>
<body>
<!-- Background Image with Overlay -->
<div class="bg-image"></div>
<div class="bg-overlay"></div>

<div class="container">
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="3 11 22 2 13 21 11 13 3 11"/>
            </svg>
            <span class="logo-text">Trip</span> <span class="logo-sub">.com</span>
        </div>
        <nav class="nav-links">
            <a href="home.html" class="nav-link">Home</a>
            <a href="destination.html" class="nav-link">Destinations</a>
            <a href="guides.html" class="nav-link">Guides</a>
<!--            <a href="" class="nav-link active">Universities</a>-->
            <a href="vehicle.html" class="nav-link">Vehicle Rentals</a>
            <a href="feedBack.html" class="nav-link">FeedBack</a>
        </nav>
        <button class="btn-logout" onclick="logout()">Logout</button>
    </header>

    <!-- Page Title -->
    <div class="page-title">
        <h1>Book Your Dream Vacation</h1>
        <p>Complete your booking in a few simple steps</p>
    </div>

    <!-- Booking Progress -->
    <div class="booking-progress">
        <div class="progress-step">
            <div class="step-number active">1</div>
            <div class="step-label active">Trip Details</div>
        </div>
        <div class="progress-step">
            <div class="step-number">2</div>
            <div class="step-label">Booking Information</div>
        </div>
        <div class="progress-step">
            <div class="step-number">3</div>
            <div class="step-label">Payment</div>
        </div>
        <div class="progress-step">
            <div class="step-number">4</div>
            <div class="step-label">Confirmation</div>
        </div>
    </div>

    <!-- Booking Section -->
    <div class="booking-section">
        <!-- Booking Form -->
        <div class="booking-form" id="booking-form-container">
            <h2 class="form-title">Booking Details</h2>
            <form id="add-booking-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="chosenPackage">Chosen Package</label>
                        <select class="form-select" id="chosenPackage" required>
                            <option value="">Select a package</option>
                            <!--<option value="budget">Budget Explorer Package</option>
                            <option value="classic">Classic Sri Lanka Package</option>
                            <option value="luxury">Luxury Paradise Package</option>-->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="travel-date">Date</label>
                        <input type="date" class="form-input" id="travel-date" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="guests">No. of Guests</label>
                        <input type="number" class="form-input" id="guests" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="full-name">Full Name</label>
                        <input type="text" class="form-input" id="full-name" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="email_address">Email Address</label>
                        <input type="email" class="form-input" id="email_address" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="phone_number">Phone Number</label>
                        <input type="tel" class="form-input" id="phone_number" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" id="cancel-add">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Booking</button>
                </div>
            </form>
        </div>
    </div>
</div>





<!-- jQuery (must be before toastr) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Toastr CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<!-- Toastr JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("add-booking-form");
        const chosenPackageSelect = document.getElementById("chosenPackage");

        // 1️⃣ Fetch all packages and populate the select dropdown
        async function loadPackages() {
            try {
                const response = await fetch("http://localhost:8080/api/packages");
                const result = await response.json();
                if (response.ok && result.data) {
                    // Clear existing options except the first
                    chosenPackageSelect.innerHTML = '<option value="">Select a package</option>';

                    result.data.forEach(pkg => {
                        const option = document.createElement("option");
                        option.value = pkg.title; // or pkg.id if you want to store id
                        option.textContent = pkg.title;
                        chosenPackageSelect.appendChild(option);
                    });
                } else {
                    console.error("Failed to load packages", result.message);
                    toastr.error("Failed to load packages", "Error");
                }
            } catch (error) {
                console.error("Error fetching packages:", error);
                toastr.error("Failed to load packages", "Error");
            }
        }

        loadPackages();

        // 2️⃣ Handle booking form submission
        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const bookingData = {
                chosenPackage: chosenPackageSelect.value,
                travelDate: document.getElementById("travel-date").value,
                guests: parseInt(document.getElementById("guests").value),
                fullName: document.getElementById("full-name").value,
                email: document.getElementById("email_address").value,
                phone: document.getElementById("phone_number").value
            };

            try {
                const response = await fetch("http://localhost:8080/api/packageBooking", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();

                if (response.ok) {
                    // Redirect or show confirmation
                    window.location.href = "pkgBookingInformation.html";
                    form.reset();
                } else {
                    alert("Error: " + result.message);
                }
            } catch (error) {
                console.error("Error saving booking:", error);
                // alert("Something went wrong while saving your booking.");
                toastr.error("Something went wrong while saving your booking.", "Error");
            }
        });

        document.getElementById("cancel-add").addEventListener("click", () => form.reset()
        );

        // ===== Auth check (inside DOMContentLoaded) =====
        const token = getCookie("token");
        if (!token) {
            toastr.warning("You must be logged in.", "Access Denied");
            setTimeout(() => window.location.href = "login.html", 1500);
        }
    });

    // ===== Cookie Helpers (GLOBAL scope) =====
    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i].trim();
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function deleteCookie(name) {
        document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax;";
    }

    // ===== Logout (GLOBAL so button onclick works) =====
    function logout() {
        deleteCookie("token");
        deleteCookie("username");
        toastr.info("Logged out successfully.", "Logout");
        setTimeout(() => window.location.href = "index.html", 1500);
    }

    // Toastr settings (optional customization)
    toastr.options = {
        "closeButton": true,
        "progressBar": true,
        "positionClass": "toast-top-right",
        "timeOut": "4000"
    };
</script>
</body>
</html>