<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Admin Dashboard - Trip.com</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link rel="stylesheet" href="css/adminDashboard.css">
</head>
<body>
<div class="app">
    <aside class="sidebar">
        <div class="brand">
            <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="3 11 22 2 13 21 11 13 3 11"/>
            </svg>
            <div>
                <span class="logo-text">Trip</span> <span class="logo-sub">.com</span>
                <div class="muted" style="font-size:12px">Admin Dashboard</div>
            </div>
        </div>
        <nav>
            <ul>
                <li class="active" data-view="overview">Overview</li>
                <li data-view="popular-destination">Popular Destinations</li>
                <li data-view="packages">Packages</li>
                <li data-view="destinations">All Destinations</li>
                <li data-view="gallery">Gallery</li>
                <li data-view="contact">Contact Us</li>
                <li data-view="guides">Guides</li>
                <li data-view="travelTips">Travel Tips</li>
                <li data-view="settings">Settings</li>
            </ul>
        </nav>
    </aside>

    <section style="padding:0 8px;">
        <header>
            <div class="search">
                <input id="global-search" placeholder="Search"/>
                <div class="muted">Quick search</div>
            </div>
            <div class="actions">
<!--                <div class="pill">Notifications</div>-->
                <button class="btn" id="logout" onclick="logout()">Logout</button>
            </div>
        </header>

        <main>
            <!-- STATS -->
            <div class="grid view-section" id="overview">
                <div class="card"><h3>Total Revenue</h3><div class="stat">$12,420</div><div class="muted">Last 30 days</div></div>
                <div class="card"><h3>Orders</h3><div class="stat">1,294</div><div class="muted">Pending: 18</div></div>
                <div class="card"><h3>Active Customers</h3><div class="stat">3,220</div><div class="muted">New: 124</div></div>
            </div>

            <!-- POPULAR DESTINATION -->
            <div class="table-wrap view-section" id="popular-destination" style="display:none">
                <h3 style="margin:0 0 10px">Popular Destination</h3>
                <div class="form-row">
                    <input id="pd-title" placeholder="Title">
                    <input id="pd-location" placeholder="Location">
                </div>
                <div class="form-row">
                    <input id="pd-image" placeholder="Image URL">
                    <input id="pd-duration" placeholder="Duration">
                </div>
                <div class="form-row">
                    <input id="pd-currency" placeholder="Currency">
                    <input id="pd-price" placeholder="Price">
                </div>
                <div class="form-row">
                    <input id="pd-rating" placeholder="Rating">
                    <input id="pd-reviews" placeholder="Reviews">
                </div>
                <button class="btn" id="add-pd">Add Destination</button>
                <button class="btn" id="update-pd">Update Destination</button>
                <button class="btn" id="refresh-pd" title="Refresh">
                    <i class="fa fa-sync-alt"></i>
                </button>


                <hr style="margin:15px 0; border-color:rgba(255,255,255,0.1)">

                <h3>Popular Destination List</h3>
                <table id="popular-destination-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Location</th>
                            <th>Image_URL</th>
                            <th>Duration</th>
                            <th>Currency</th>
                            <th>Price</th>
                            <th>Rating</th>
                            <th>Reviews</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- PACKAGES -->
            <div class="table-wrap view-section" id="packages" style="display:none">
                <h3 style="margin:0 0 10px">Packages</h3>
                <div class="form-row">
                    <input id="pkg-title" placeholder="Title">
                    <input id="pkg-tag" placeholder="Tag">
                </div>
                <div class="form-row">
                    <input id="pkg-features" placeholder="Features">
                    <input id="pkg-unit" placeholder="Unit">
                </div>
                <div class="form-row">
                    <input id="pkg-price" placeholder="Price">
                    <input id="pkg-description" placeholder="Description">
                </div>
                <button class="btn" id="add-package">Add Package</button>
                <button class="btn" id="update-package">Update Package</button>
                <button class="btn" id="refresh-package" title="Refresh">
                    <i class="fa fa-sync-alt"></i>
                </button>

                <hr style="margin:15px 0; border-color:rgba(255,255,255,0.1)">

                <h3>Packages List</h3>
                <table id="package-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Tag</th>
                            <th>Unit</th>
                            <th>Description</th>
                            <th>Features</th>
                            <th>Price</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- ALL DESTINATIONS -->
            <div class="table-wrap view-section" id="destinations" style="display:none">
                <h3 style="margin:0 0 10px">All Destinations</h3>
                <div class="form-row">
                    <input id="dest-title" placeholder="Title">
                    <input id="dest-location" placeholder="Location">
                </div>
                <div class="form-row">
                    <input id="dest-image" placeholder="Image URL">
                    <input id="dest-currency" placeholder="Currency">
                </div>
                <div class="form-row">
                    <input id="dest-price" placeholder="Price">
                    <input id="dest-priceRange" placeholder="Price Range">
                </div>
                <div class="form-row">
                    <input id="dest-category" placeholder="Category">
                    <input id="dest-rating" placeholder="Rating">
                </div>
                <button class="btn" id="add-destinations">Add Destination</button>
                <button class="btn" id="update-destinations">Update Destination</button>
                <button class="btn" id="refresh-destinations" title="Refresh">
                    <i class="fa fa-sync-alt"></i>
                </button>

                <hr style="margin:15px 0; border-color:rgba(255,255,255,0.1)">

                <h3>All Destinations List</h3>
                <table id="destinations-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Location</th>
                            <th>Image</th>
                            <th>Currency</th>
                            <th>Price</th>
                            <th>Price Range</th>
                            <th>Category</th>
                            <th>Rating</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- GALLERY -->
            <div class="table-wrap view-section" id="gallery" style="display:none">
                <h3 style="margin:0 0 10px">Gallery</h3>
                <div class="form-row">
                    <input id="gallery-image" placeholder="Image URL">
                </div>
                <button class="btn" id="add-gallery">Add Image</button>
                <button class="btn" id="update-gallery">Update Image</button>
                <button class="btn" id="refresh-gallery" title="Refresh">
                    <i class="fa fa-sync-alt"></i>
                </button>

                <hr style="margin:15px 0; border-color:rgba(255,255,255,0.1)">

                <h3>Gallery List</h3>
                <table id="gallery-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Image_URL</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- CONTACT US -->
            <div class="table-wrap view-section" id="contact" style="display:none">

                <h3>All Destinations List</h3>
                <table id="contact-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Subject</th>
                            <th>Message</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>


            <!--GUIDES-->
            <div class="table-wrap view-section" id="guides" style="display:none">
                <h3 style="margin:0 0 10px">Guides</h3>
                <div class="form-row">
                    <input id="guide-name" placeholder="Name">
                    <input id="guide-position" placeholder="Position">
                </div>
                <div class="form-row">
                    <input id="guide-experience" placeholder="Experience Year">
                    <input id="guide-location" placeholder="Location">
                </div>
                <div class="form-row">
                    <input id="guide-specialities" placeholder="Specialities">
                    <input id="guide-bio" placeholder="Bio">
                </div>
                <div class="form-row">
                    <input id="guide-image" placeholder="Image URL">
<!--                    <input id="guide-social" placeholder="Social Media">-->
                    <input type="text" id="guide-facebook" placeholder="Facebook URL">
                </div>
                <div class="form-row">
                    <input type="text" id="guide-instagram" placeholder="Instagram URL">
                    <input type="text" id="guide-linkedin" placeholder="LinkedIn URL">
                </div>
                <button class="btn" id="add-guide">Add Guide</button>
                <button class="btn" id="update-guide">Update Guide</button>
                <button class="btn" id="refresh-guide" title="Refresh">
                    <i class="fa fa-sync-alt"></i>
                </button>

                <hr style="margin:15px 0; border-color:rgba(255,255,255,0.1)">

                <h3>All Guides List</h3>
                <table id="guides-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Experience Year</th>
                            <th>Location</th>
                            <th>Specialities</th>
                            <th>Bio</th>
                            <th>Image</th>
                            <th>Social Media</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </main>
    </section>
</div>

<script>
    // Sidebar navigation
    const navItems = document.querySelectorAll("nav li");
    const sections = document.querySelectorAll(".view-section");
    navItems.forEach(item=>{
        item.addEventListener("click",()=>{
            navItems.forEach(i=>i.classList.remove("active"));
            item.classList.add("active");
            const view=item.getAttribute("data-view");
            sections.forEach(sec=>{
                sec.style.display=(sec.id===view)?"block":"none";
            });
        });
    });

    // ================== GLOBAL SEARCH ==================
    const searchInput = document.getElementById("global-search");
    searchInput.addEventListener("input", () => {
        const query = searchInput.value.toLowerCase();

        // function to filter a table by search query
        const filterTable = (tableId) => {
            const table = document.getElementById(tableId);
            const rows = table.querySelectorAll("tbody tr");
            rows.forEach(row => {
                const text = row.innerText.toLowerCase();
                row.style.display = text.includes(query) ? "" : "none";
            });
        };

        // Apply search to all tables
        filterTable("popular-destination-table");
        filterTable("package-table");
        filterTable("destinations-table");
        filterTable("gallery-table");
        filterTable("contact-table");
    });

    // ================== LOAD POPULAR DESTINATIONS ==================
    async function loadDestinations() {
        try {
            const res = await fetch("http://localhost:8080/api/destinations");
            const json = await res.json();

            const destinations = json.data;
            if (!Array.isArray(destinations)) {
                console.error("Expected an array but got:", destinations);
                return;
            }

            const tableBody = document.querySelector("#popular-destination-table tbody");
            tableBody.innerHTML = "";
            destinations.forEach(dest => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${dest.id}</td>
                <td>${dest.title}</td>
                <td>${dest.location}</td>
                <td><img src="${dest.imageUrl}" width="80"></td>
                <td>${dest.duration}</td>
                <td>${dest.currency}</td>
                <td>${dest.price}</td>
                <td>${dest.rating}</td>
                <td>${dest.reviews}</td>
                <td>
                    <button class="update-popDest btn-primary" data-id="${dest.id}">
                        <i class="fa fa-pencil-alt"></i>
                    </button>
                    <button class="delete-popDest btn-danger" data-id="${dest.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            `;
                tableBody.appendChild(tr);
            });

            // Delete Popular Destination
            document.querySelectorAll(".delete-popDest").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/destinations/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadDestinations();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });

            let selectedPdId = null; // global variable

            // When user clicks table "Update" button
            document.addEventListener("click", (e) => {
                if (e.target.classList.contains("update-popDest")) {
                    const row = e.target.closest("tr");
                    selectedPdId = e.target.getAttribute("data-id"); // save the id

                    document.getElementById("pd-title").value = row.children[1].innerText;
                    document.getElementById("pd-location").value = row.children[2].innerText;
                    document.getElementById("pd-image").value = row.children[3].querySelector("img")?.src || "";
                    document.getElementById("pd-duration").value = row.children[4].innerText;
                    document.getElementById("pd-currency").value = row.children[5].innerText;
                    document.getElementById("pd-price").value = row.children[6].innerText;
                    document.getElementById("pd-rating").value = row.children[7].innerText;
                    document.getElementById("pd-reviews").value = row.children[8].innerText;
                }
            });

            // Update button click
            document.getElementById("update-pd").addEventListener("click", async () => {
                if (!selectedPdId) {
                    alert("Please select a row to update first!");
                    return;
                }

                const dto = {
                    title: document.getElementById("pd-title").value,
                    location: document.getElementById("pd-location").value,
                    imageUrl: document.getElementById("pd-image").value,
                    duration: document.getElementById("pd-duration").value,
                    currency: document.getElementById("pd-currency").value,
                    price: parseFloat(document.getElementById("pd-price").value),
                    rating: parseFloat(document.getElementById("pd-rating").value),
                    reviews: parseInt(document.getElementById("pd-reviews").value)
                };

                try {
                    const res = await fetch(`http://localhost:8080/api/destinations/${selectedPdId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(dto)
                    });

                    if (res.ok) {
                        // alert("Updated successfully!");
                        loadDestinations();
                        selectedPdId = null;
                        document.querySelectorAll("#popular-destination input").forEach(i => i.value = "");
                    } else {
                        alert("Failed to update!");
                    }
                } catch (err) {
                    console.error("Update error:", err);
                }
            });
        } catch (err) {
            console.error(err);
        }
        document.querySelectorAll("#popular-destination input").forEach(i => i.value = "");
    }

    document.getElementById("refresh-pd").addEventListener("click", () => {
        document.querySelectorAll("#popular-destination input").forEach(i => i.value = "");
    });

    // ================== LOAD PACKAGES ==================
    async function loadPackages() {
        try {
            const res = await fetch("http://localhost:8080/api/packages");
            const json = await res.json();

            const packages = json.data;
            if (!Array.isArray(packages)) {
                console.error("Expected an array but got:", packages);
                return;
            }

            const tableBody = document.querySelector("#package-table tbody");
            tableBody.innerHTML = "";
            packages.forEach(pkg => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${pkg.id}</td>
                <td>${pkg.title}</td>
                <td>${pkg.tag}</td>
                <td>${pkg.unit}</td>
                <td>${pkg.description}</td>
                <td>${Array.isArray(pkg.features) ? pkg.features.join(", ") : pkg.features}</td>
                <td>${pkg.price}</td>
                <td>
                    <button class="update-pkg btn-primary" data-id="${pkg.id}">
                        <i class="fa fa-pencil-alt"></i>
                    </button>
                    <button class="delete-pkg btn-danger" data-id="${pkg.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            `;
                tableBody.appendChild(tr);
            });

            // Delete Packages
            document.querySelectorAll(".delete-pkg").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/packages/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadPackages();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });

            let selectedPkgId = null;

            // Handle Update click
            document.addEventListener("click", (e) => {
                const btn = e.target.closest(".update-pkg");
                if (btn) {
                    const row = btn.closest("tr");
                    selectedPkgId = btn.getAttribute("data-id");

                    document.getElementById("pkg-title").value = row.children[1].innerText;
                    document.getElementById("pkg-tag").value = row.children[2].innerText;
                    document.getElementById("pkg-unit").value = row.children[3].innerText;
                    document.getElementById("pkg-description").value = row.children[4].innerText;
                    document.getElementById("pkg-features").value = row.children[5].innerText;
                    document.getElementById("pkg-price").value = row.children[6].innerText;
                }
            });

            // Update button click
            document.getElementById("update-package").addEventListener("click", async () => {
                if (!selectedPkgId) {
                    alert("Please select a row to update first!");
                    return;
                }

                const dto = {
                    title: document.getElementById("pkg-title").value,
                    tag: document.getElementById("pkg-tag").value,
                    features: document.getElementById("pkg-features").value
                        .split(",")
                        .map(f => f.trim()),
                    unit: document.getElementById("pkg-unit").value,
                    price: parseFloat(document.getElementById("pkg-price").value) || 0,
                    description: document.getElementById("pkg-description").value
                };

                try {
                    const res = await fetch(`http://localhost:8080/api/packages/${selectedPkgId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(dto)
                    });

                    if (res.ok) {
                        loadPackages();
                        selectedPkgId = null;
                        document.querySelectorAll("#packages input, #packages textarea")
                            .forEach(el => el.value = "");
                    } else {
                        alert("Failed to update!");
                    }
                } catch (err) {
                    console.error("Update error:", err);
                }
            });
        } catch (err) {
            console.error("Error loading packages:", err);
        }
        document.querySelectorAll("#packages input, #packages textarea")
            .forEach(el => el.value = "");
    }

    document.getElementById("refresh-package").addEventListener("click", () => {
        document.querySelectorAll("#packages input, #packages textarea").forEach(i => i.value = "");
    });

    // ================== LOAD ALL DESTINATIONS ==================
    async function loadAllDestinations() {
        try {
            const res = await fetch("http://localhost:8080/api/allDestinations");
            const json = await res.json();

            const destinations = json.data;
            if (!Array.isArray(destinations)) {
                console.error("Expected an array but got:", destinations);
                return;
            }

            const tableBody = document.querySelector("#destinations-table tbody");
            tableBody.innerHTML = "";
            destinations.forEach(dest => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${dest.id}</td>
                <td>${dest.title}</td>
                <td>${dest.location}</td>
                <td><img src="${dest.imageUrl}" width="80"></td>
                <td>${dest.currency || ''}</td>
                <td>${dest.price || ''}</td>
                <td>${dest.priceRange || ''}</td>
                <td>${(dest.category || []).join(", ")}</td>
                <td>${dest.rating || ''}</td>
                <td>
                    <button class="update-allDest btn-primary" data-id="${dest.id}">
                        <i class="fa fa-pencil-alt"></i>
                    </button>
                    <button class="delete-allDest btn-danger" data-id="${dest.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            `;
                tableBody.appendChild(tr);
            });

            // Delete All Destinations
            document.querySelectorAll(".delete-allDest").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/allDestinations/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadAllDestinations();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });

            let selectedADId = null;

            // When user clicks table "Update" button
            document.addEventListener("click", (e) => {
                if (e.target.classList.contains("update-allDest")) {
                    const row = e.target.closest("tr");
                    selectedADId = e.target.getAttribute("data-id");

                    document.getElementById("dest-title").value = row.children[1].innerText;
                    document.getElementById("dest-location").value = row.children[2].innerText;
                    document.getElementById("dest-image").value = row.children[3].querySelector("img")?.src || "";
                    document.getElementById("dest-currency").value = row.children[4].innerText;
                    document.getElementById("dest-price").value = row.children[5].innerText;
                    document.getElementById("dest-priceRange").value = row.children[6].innerText;
                    document.getElementById("dest-category").value = row.children[7].innerText;
                    document.getElementById("dest-rating").value = row.children[8].innerText;
                }
            });

            // Update button click
            document.getElementById("update-destinations").addEventListener("click", async () => {
                if (!selectedADId) {
                    alert("Please select a row to update first!");
                    return;
                }

                const dto = {
                    title: document.getElementById("dest-title").value,
                    location: document.getElementById("dest-location").value,
                    imageUrl: document.getElementById("dest-image").value,
                    currency: document.getElementById("dest-currency").value,
                    price: parseFloat(document.getElementById("dest-price").value) || 0,
                    priceRange: document.getElementById("dest-priceRange").value,
                    category: document.getElementById("dest-category").value.split(",").map(c => c.trim()),
                    rating: parseFloat(document.getElementById("dest-rating").value) || 0
                };

                try {
                    const res = await fetch(`http://localhost:8080/api/allDestinations/${selectedADId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(dto)
                    });

                    if (res.ok) {
                        // alert("Updated successfully!");
                        loadAllDestinations();
                        selectedADId = null;
                        document.querySelectorAll("#destinations input").forEach(i => i.value = "");
                    } else {
                        alert("Failed to update!");
                    }
                } catch (err) {
                    console.error("Update error:", err);
                }
            });
        } catch (err) {
            console.error(err);
        }
        document.querySelectorAll("#destinations input").forEach(i => i.value = "");
    }

    document.getElementById("refresh-destinations").addEventListener("click", () => {
        document.querySelectorAll("#destinations input").forEach(i => i.value = "");
    });

    // ================== LOAD GALLERY ==================
    async function loadGallery() {
        try {
            const res = await fetch("http://localhost:8080/api/galleries");
            const json = await res.json();

            // Ensure json.data is an array
            const galleries = json.data;
            if (!Array.isArray(galleries)) {
                console.error("Expected an array but got:", galleries);
                return;
            }

            const tableBody = document.querySelector("#gallery-table tbody");
            tableBody.innerHTML = "";

            galleries.forEach(gallery => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${gallery.id || ''}</td>
                    <td><img src="${gallery.imageUrl || ''}" width="80"></td>
                    <td>
                    <button class="update-gallery btn-primary" data-id="${gallery.id}">
                        <i class="fa fa-pencil-alt"></i>
                    </button>
                    <button class="delete-gallery btn-danger" data-id="${gallery.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
                `;
                tableBody.appendChild(tr);
            });

            // Delete Gallery
            document.querySelectorAll(".delete-gallery").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/galleries/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadGallery();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });

            let selectedGalleryId = null;

            // When user clicks table "Update" button
            document.addEventListener("click", (e) => {
                if (e.target.classList.contains("update-gallery")) {
                    const row = e.target.closest("tr");
                    selectedGalleryId = e.target.getAttribute("data-id");

                    document.getElementById("gallery-image").value = row.children[1].querySelector("img")?.src || "";
                }
            });

            // Update button click
            document.getElementById("update-gallery").addEventListener("click", async () => {
                if (!selectedGalleryId) {
                    alert("Please select a row to update first!");
                    return;
                }

                const dto = {
                    imageUrl: document.getElementById("gallery-image").value
                };

                try {
                    const res = await fetch(`http://localhost:8080/api/galleries/${selectedGalleryId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(dto)
                    });

                    if (res.ok) {
                        // alert("Updated successfully!");
                        loadGallery();
                        selectedGalleryId = null;
                        document.querySelectorAll("#gallery input").forEach(i => i.value = "");
                    } else {
                        alert("Failed to update!");
                    }
                } catch (err) {
                    console.error("Update error:", err);
                }
            });
        } catch (err) {
            console.error("Error loading gallery:", err);
        }
        document.querySelectorAll("#gallery input").forEach(i => i.value = "");
    }

    document.getElementById("refresh-gallery").addEventListener("click", () => {
        document.querySelectorAll("#gallery input").forEach(i => i.value = "");
    });

    // ================== LOAD CONTACT ==================
    async function loadContact() {
        try {
            const res = await fetch("http://localhost:8080/api/contacts");
            const json = await res.json();

            const contacts = json.data;
            if (!Array.isArray(contacts)) {
                console.error("Expected an array but got:", contacts);
                return;
            }

            const tableBody = document.querySelector("#contact-table tbody");
            tableBody.innerHTML = "";

            contacts.forEach(contact => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${contact.id || ''}</td>
                <td>${contact.name || ''}</td>
                <td>${contact.email || ''}</td>
                <td>${contact.subject || ''}</td>
                <td>${contact.message || ''}</td>
                <td>
                    <button class="delete-contact btn-danger" data-id="${contact.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            `;
                tableBody.appendChild(tr);
            });

            // Delete Contact
            document.querySelectorAll(".delete-contact").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/contacts/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadContact();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });
        } catch (err) {
            console.error("Error loading contacts:", err);
        }
    }

    // ================== LOAD GUIDE ==================
    async function loadGuide() {
        try {
            const res = await fetch("http://localhost:8080/api/guides");
            const json = await res.json();

            // Ensure json.data is an array
            const guides = json.data;
            if (!Array.isArray(guides)) {
                console.error("Expected an array but got:", guides);
                return;
            }

            const tableBody = document.querySelector("#guides-table tbody");
            tableBody.innerHTML = "";

            guides.forEach(guide => {
                // Convert socialLinks map -> HTML links
                let socialLinksHtml = "";
                if (guide.socialLinks) {
                    socialLinksHtml = Object.entries(guide.socialLinks)
                        .map(([platform, url]) => {
                            return `<a href="${url}" target="_blank">${platform}</a>`;
                        })
                        .join(" | ");
                }

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${guide.id || ''}</td>
                    <td>${guide.name || ''}</td>
                    <td>${guide.position || ''}</td>
                    <td>${guide.experienceYears || ''}</td>
                    <td>${guide.location || ''}</td>
                    <td>${guide.specialities || ''}</td>
                    <td>${guide.bio || ''}</td>
                    <td><img src="${guide.imagePath || ''}" width="80"></td>
                    <td>${socialLinksHtml}</td>
                    <td>
                        <button class="update-guides btn-primary" data-id="${guide.id}">
                            <i class="fa fa-pencil-alt"></i>
                        </button>
                        <button class="delete-guides btn-danger" data-id="${guide.id}">
                            <i class="fa fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });

            // Delete Guides
            document.querySelectorAll(".delete-guides").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/guides/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadGuide();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });

            let selectedGuidesId = null;

            // ================== Handle Update Click ==================
            document.addEventListener("click", (e) => {
                const btn = e.target.closest(".update-guides");
                if (!btn) return;

                const row = btn.closest("tr");
                selectedGuidesId = btn.getAttribute("data-id");

                document.getElementById("guide-name").value = row.children[1].innerText.trim();
                document.getElementById("guide-position").value = row.children[2].innerText.trim();
                document.getElementById("guide-experience").value = row.children[3].innerText.trim();
                document.getElementById("guide-location").value = row.children[4].innerText.trim();
                document.getElementById("guide-specialities").value = row.children[5].innerText.trim();
                document.getElementById("guide-bio").value = row.children[6].innerText.trim();
                document.getElementById("guide-image").value = row.children[7].querySelector("img")?.src || "";

                // Extract social links from row
                const socialLinks = {};
                row.children[8].querySelectorAll("a").forEach(a => {
                    const platform = a.innerText.toLowerCase();
                    socialLinks[platform] = a.href;
                });

                document.getElementById("guide-facebook").value = socialLinks.facebook || "";
                document.getElementById("guide-instagram").value = socialLinks.instagram || "";
                document.getElementById("guide-linkedin").value = socialLinks.linkedin || "";
            });

            // ================== Update Button Click ==================
            document.getElementById("update-guide").addEventListener("click", async () => {
                if (!selectedGuidesId) {
                    alert("⚠️ Please select a row to update first!");
                    return;
                }

                const dto = {
                    name: document.getElementById("guide-name").value.trim(),
                    position: document.getElementById("guide-position").value.trim(),
                    experienceYears: document.getElementById("guide-experience").value.trim(),
                    location: document.getElementById("guide-location").value.trim(),
                    specialities: document.getElementById("guide-specialities").value.trim(),
                    bio: document.getElementById("guide-bio").value.trim(),
                    imagePath: document.getElementById("guide-image").value.trim(),
                    socialLinks: {
                        facebook: document.getElementById("guide-facebook").value.trim(),
                        instagram: document.getElementById("guide-instagram").value.trim(),
                        linkedin: document.getElementById("guide-linkedin").value.trim()
                    }
                };

                try {
                    const res = await fetch(`http://localhost:8080/api/guides/${selectedGuidesId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(dto)
                    });

                    if (res.ok) {
                        await loadGuide();
                        selectedGuidesId = null;

                        document.querySelectorAll("#guides input, #guides textarea")
                            .forEach(el => el.value = "");

                        alert("✅ Guide updated successfully!");
                    } else {
                        alert("❌ Failed to update guide!");
                    }
                } catch (err) {
                    console.error("Update error:", err);
                    alert("⚠️ An error occurred while updating!");
                }
            });
        } catch (err) {
            console.error("Error loading gallery:", err);
        }
        document.querySelectorAll("#guides input").forEach(i => i.value = "");
    }

    document.getElementById("refresh-guide").addEventListener("click", () => {
        document.querySelectorAll("#guides input").forEach(i => i.value = "");
    });



    // ----------------------Data Saving----------------------
    // ================== POPULAR DESTINATIONS ==================
    document.getElementById("add-pd").addEventListener("click", async () => {
        const dto = {
            title: document.getElementById("pd-title").value,
            location: document.getElementById("pd-location").value,
            imageUrl: document.getElementById("pd-image").value,
            duration: document.getElementById("pd-duration").value,
            currency: document.getElementById("pd-currency").value,
            price: parseFloat(document.getElementById("pd-price").value),
            rating: parseFloat(document.getElementById("pd-rating").value),
            reviews: parseInt(document.getElementById("pd-reviews").value)
        };

        try {
            const res = await fetch("http://localhost:8080/api/destinations", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dto)
            });

            if (res.ok) {
                alert("Popular Destination save is successful!");
                loadDestinations();
            } else {
                alert("Popular Destination save is failed!");
            }
        } catch (err) {
            console.error(err);
        }

        //input clear
        document.querySelectorAll("#popular-destination input").forEach(i => i.value = "");
    });

    // ================== PACKAGES ==================
    document.getElementById("add-package").addEventListener("click", async () => {
        const dto = {
            title: document.getElementById("pkg-title").value,
            tag: document.getElementById("pkg-tag").value,
            features: document.getElementById("pkg-features").value
                .split(",")
                .map(f => f.trim()),  // comma separated features
            unit: document.getElementById("pkg-unit").value,
            price: parseFloat(document.getElementById("pkg-price").value) || 0,
            description: document.getElementById("pkg-description").value
        };

        try {
            const res = await fetch("http://localhost:8080/api/packages", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dto)
            });

            if (res.ok) {
                alert("Package save is successful!");
                loadPackages();
            } else {
                alert("Package save is failed!");
            }
        } catch (err) {
            console.error("Error saving package:", err);
        }

        // input clear
        document.querySelectorAll("#packages input").forEach(i => i.value = "");
    });

    // ================== ADD ALL DESTINATIONS ==================
    document.getElementById("add-destinations").addEventListener("click", async () => {
        const dto = {
            title: document.getElementById("dest-title").value,
            location: document.getElementById("dest-location").value,
            imageUrl: document.getElementById("dest-image").value,
            currency: document.getElementById("dest-currency").value,
            price: parseFloat(document.getElementById("dest-price").value) || 0,
            priceRange: document.getElementById("dest-priceRange").value,
            category: document.getElementById("dest-category").value.split(",").map(c => c.trim()),
            rating: parseFloat(document.getElementById("dest-rating").value) || 0
        };

        try {
            const res = await fetch("http://localhost:8080/api/allDestinations", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dto)
            });

            if (res.ok) {
                alert("Destination save is successful!");
                loadAllDestinations();
            } else {
                alert("Destination save is failed!");
            }
        } catch (err) {
            console.error(err);
        }

        //input clear
        document.querySelectorAll("#destinations input").forEach(i => i.value = "");
    });

    // ================== ADD GALLERY IMAGE ==================
    document.getElementById("add-gallery").addEventListener("click", async () => {
        const dto = {
            imageUrl: document.getElementById("gallery-image").value
        };

        try {
            const res = await fetch("http://localhost:8080/api/galleries", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dto)
            });

            if (res.ok) {
                alert("Gallery image added successfully!");
                loadGallery();
            } else {
                alert("Failed to add gallery image!");
            }
        } catch (err) {
            console.error("Error saving gallery image:", err);
        }

        // Clear input
        document.getElementById("gallery-image").value = "";
    });

    // ================== INITIAL LOAD ==================
    window.addEventListener("DOMContentLoaded", () => {
        loadDestinations();
        loadPackages();
        loadAllDestinations();
        loadGallery();
        loadContact();
        loadGuide();

        // ===== Auth check (inside DOMContentLoaded) =====
        const token = getCookie("token");
        if (!token) {
            // toastr.warning("You must be logged in.", "Access Denied");
            setTimeout(() => window.location.href = "login.html", 1500);
        }
    });

    // ===== Cookie Helpers (GLOBAL scope) =====
    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i].trim();
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function deleteCookie(name) {
        document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax;";
    }

    // ===== Logout (GLOBAL so button onclick works) =====
    function logout() {
        deleteCookie("token");
        deleteCookie("username");
        // toastr.info("Logged out successfully.", "Logout");
        setTimeout(() => window.location.href = "index.html", 1500);
    }
</script>
</body>
</html>