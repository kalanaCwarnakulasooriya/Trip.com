<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Admin Dashboard - Trip.com</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        :root{
            --bg:#0f1724;
            --card:#0b1220;
            --accent:#22c1c3;
            --muted:#94a3b8;
            --glass: rgba(255,255,255,0.03);
            --primary-color: #2a9df4;
            --primary-dark: #1a7ac5;
            --primary-light: #7fc1f9;
            --secondary-color: #ff6b6b;
            --text-color: #333333;
            --text-light: #666666;
            --text-lighter: #999999;
            --bg-color: #ffffff;
            --bg-light: #f8f9fa;
            --bg-dark: #212529;
            --border-color: #e9ecef;
            --border-radius: 8px;
            --transition: all 0.3s ease;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --box-shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        *{
            box-sizing:border-box;
            font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial
        }
        body{
            margin:0;
            background:linear-gradient(180deg,#071029 0%, #071a2a 100%);
            color:#e6eef6;
            min-height:100vh
        }
        .app{
            display:grid;
            grid-template-columns:260px 1fr;
            gap:20px;
            padding:22px
        }
        /* SIDEBAR */
        .sidebar{
            background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
            border-radius:14px;
            padding:18px;
            height:calc(100vh - 44px);
            position:sticky;
            top:22px;
            overflow:auto
        }
        .brand{
            display:flex;
            gap:12px;
            align-items:center;
            margin-bottom:18px
        }
        .logo-icon {
            width: 35px;
            height: 35px;
            margin-right: 0.5rem;
            color: var(--primary-color);
        }
        .logo-text {
            font-size: 32px;
            font-weight: bold;
            font-family: "Droid Sans", sans-serif;
            color: var(--primary-color);
        }
        .logo-sub {
            font-size: 25px;
            font-family: Sylfaen;
            color: var(--primary-color);
        }
        nav ul{
            list-style:none;
            padding:0;
            margin:8px 0
        }
        nav li{
            padding:10px;
            border-radius:8px;
            margin:6px 0;
            cursor:pointer;
            color:var(--muted)
        }
        nav li.active, nav li:hover{
            background:var(--glass);color:#fff
        }
        /* HEADER */
        header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:14px 22px;
            border-radius:14px;
            background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
        }

        .search{
            display:flex;
            gap:10px;
            align-items:center
        }

        .search input{
            background:transparent;
            border:1px solid rgba(255,255,255,0.04);
            padding:10px 12px;
            border-radius:10px;
            color:inherit;
            min-width:300px
        }

        .search input:focus,
        .search input:hover{
            border: 1px solid var(--primary-color);
        }

        .actions{
            display:flex;
            gap:12px;
            align-items:center
        }

        .btn{
            padding:11px 20px;
            border-radius:10px;
            background:linear-gradient(90deg,var(--accent),#2a9df4);
            border:none;
            color:#042031;
            font-weight:600;
            cursor:pointer
        }

        .btn:hover{
            background:var(--primary-color);
            /*color: #fff;*/
        }
        /* CONTENT */
        main{padding:12px 0}
        .grid{
            display:grid;
            grid-template-columns:repeat(3,1fr);
            gap:14px;
            margin-bottom:18px
        }
        .card{
            background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
            padding:16px;
            border-radius:12px
        }
        .card h3{margin:0 0 8px 0;font-size:14px;color:var(--muted)}
        .stat{font-size:22px;font-weight:700}
        /* ================== TABLE STYLING ================== */
        .table-wrap {
            background: var(--card);
            padding: 18px;
            border-radius: 14px;
            box-shadow: var(--box-shadow);
            overflow-x: auto;
        }

        /* Base table */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 14px;
            border-radius: 12px;
            overflow: hidden;
        }

        /* Table head */
        thead {
            background: rgba(42, 157, 244, 0.08);
        }

        th {
            color: #e6eef6;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 13px;
            padding: 12px 10px;
            text-align: left;
            border-bottom: 2px solid rgba(255, 255, 255, 0.05);
            position: sticky;
            top: 0;
            background: linear-gradient(180deg,#071029 0%, #071a2a 100%);
            z-index: 2;
        }

        /* Table rows */
        tbody tr {
            transition: var(--transition);
        }

        tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.02);
        }

        tbody tr:hover {
            background: rgba(42, 157, 244, 0.08);
            transform: scale(1.01);
        }

        /* Table cells */
        td {
            padding: 12px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            vertical-align: middle;
            color: #e6eef6;
        }

        /* Table images */
        td img {
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s ease-in-out;
        }
        td img:hover {
            transform: scale(1.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            table {
                font-size: 12px;
            }
            th, td {
                padding: 8px;
            }
        }

        /* ===== Table Action Buttons ===== */
        .btn-primary,
        .btn-danger {
            padding: 6px 12px;
            margin: 2px;
            border: none;
            border-radius: 5px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        /* Update button */
        .btn-primary {
            background-color: #2a9df4;
            color: #fff;
        }
        .btn-primary:hover {
            background-color: #1a7ac5;
            transform: scale(1.05);
        }

        /* Delete button */
        .btn-danger {
            background-color: #ff4d4d;
            color: #fff;
        }
        .btn-danger:hover {
            background-color: #cc0000;
            transform: scale(1.05);
        }

        /* FORM */
        .form-row{
            display:flex;
            gap:10px;
            margin-bottom:10px
        }

        .form-row input{
            flex:1;
            padding:8px;
            border-radius:8px;
            border:1px solid rgba(255,255,255,0.04);
            background:transparent;
            color:var(--primary-color);
        }

        .form-row input:focus,
        .form-row input:hover{
            border: 1px solid var(--primary-color);
        }
        /* Responsive */
        @media(max-width:900px){
            .app{grid-template-columns:1fr}
            .sidebar{height:auto;position:relative}
            .grid{grid-template-columns:repeat(2,1fr)}
            .search input{min-width:160px}
        }
        @media(max-width:560px){.grid{grid-template-columns:1fr}}
        .row{display:flex;gap:12px;align-items:center}
        .pill{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);font-weight:600}
        .muted{color:var(--muted)}
    </style>
</head>
<body>
<div class="app">
    <aside class="sidebar">
        <div class="brand">
            <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="3 11 22 2 13 21 11 13 3 11"/>
            </svg>
            <div>
                <span class="logo-text">Trip</span> <span class="logo-sub">.com</span>
                <div class="muted" style="font-size:12px">Admin Dashboard</div>
            </div>
        </div>
        <nav>
            <ul>
                <li class="active" data-view="overview">Overview</li>
                <li data-view="popular-destination">Popular Destinations</li>
                <li data-view="packages">Packages</li>
                <li data-view="destinations">All Destinations</li>
                <li data-view="gallery">Gallery</li>
                <li data-view="contact">Contact Us</li>
                <li data-view="settings">Settings</li>
            </ul>
        </nav>
    </aside>

    <section style="padding:0 8px;">
        <header>
            <div class="search">
                <input id="global-search" placeholder="Search"/>
                <div class="muted">Quick search</div>
            </div>
            <div class="actions">
<!--                <div class="pill">Notifications</div>-->
                <button class="btn" id="logout" onclick="logout()">Logout</button>
            </div>
        </header>

        <main>
            <!-- STATS -->
            <div class="grid view-section" id="overview">
                <div class="card"><h3>Total Revenue</h3><div class="stat">$12,420</div><div class="muted">Last 30 days</div></div>
                <div class="card"><h3>Orders</h3><div class="stat">1,294</div><div class="muted">Pending: 18</div></div>
                <div class="card"><h3>Active Customers</h3><div class="stat">3,220</div><div class="muted">New: 124</div></div>
            </div>

            <!-- POPULAR DESTINATION -->
            <div class="table-wrap view-section" id="popular-destination" style="display:none">
                <h3 style="margin:0 0 10px">Popular Destination</h3>
                <div class="form-row">
                    <input id="pd-title" placeholder="Title">
                    <input id="pd-location" placeholder="Location">
                </div>
                <div class="form-row">
                    <input id="pd-image" placeholder="Image URL">
                    <input id="pd-duration" placeholder="Duration">
                </div>
                <div class="form-row">
                    <input id="pd-currency" placeholder="Currency">
                    <input id="pd-price" placeholder="Price">
                </div>
                <div class="form-row">
                    <input id="pd-rating" placeholder="Rating">
                    <input id="pd-reviews" placeholder="Reviews">
                </div>
                <button class="btn" id="add-pd">Add Destination</button>
                <button class="btn" id="update-pd">Update Destination</button>
                <button class="btn" id="refresh-pd" title="Refresh">
                    <i class="fa fa-sync-alt"></i>
                </button>


                <hr style="margin:15px 0; border-color:rgba(255,255,255,0.1)">

                <h3>Popular Destination List</h3>
                <table id="popular-destination-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Location</th>
                            <th>Image_URL</th>
                            <th>Duration</th>
                            <th>Currency</th>
                            <th>Price</th>
                            <th>Rating</th>
                            <th>Reviews</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- PACKAGES -->
            <div class="table-wrap view-section" id="packages" style="display:none">
                <h3 style="margin:0 0 10px">Packages</h3>
                <div class="form-row">
                    <input id="pkg-title" placeholder="Title">
                    <input id="pkg-tag" placeholder="Tag">
                </div>
                <div class="form-row">
                    <input id="pkg-features" placeholder="Features">
                    <input id="pkg-unit" placeholder="Unit">
                </div>
                <div class="form-row">
                    <input id="pkg-price" placeholder="Price">
                    <input id="pkg-description" placeholder="Description">
                </div>
                <button class="btn" id="add-package">Add Package</button>
                <button class="btn" id="update-package">Update Package</button>
                <button class="btn" id="refresh-package" title="Refresh">
                    <i class="fa fa-sync-alt"></i>
                </button>

                <hr style="margin:15px 0; border-color:rgba(255,255,255,0.1)">

                <h3>Packages List</h3>
                <table id="package-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Tag</th>
                            <th>Unit</th>
                            <th>Description</th>
                            <th>Features</th>
                            <th>Price</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- ALL DESTINATIONS -->
            <div class="table-wrap view-section" id="destinations" style="display:none">
                <h3 style="margin:0 0 10px">All Destinations</h3>
                <div class="form-row">
                    <input id="dest-title" placeholder="Title">
                    <input id="dest-location" placeholder="Location">
                </div>
                <div class="form-row">
                    <input id="dest-image" placeholder="Image URL">
                    <input id="dest-currency" placeholder="Currency">
                </div>
                <div class="form-row">
                    <input id="dest-price" placeholder="Price">
                    <input id="dest-priceRange" placeholder="Price Range">
                </div>
                <div class="form-row">
                    <input id="dest-category" placeholder="Category">
                    <input id="dest-rating" placeholder="Rating">
                </div>
                <button class="btn" id="add-destinations">Add Destination</button>
                <button class="btn" id="update-destinations">Update Destination</button>
                <button class="btn" id="refresh-destinations" title="Refresh">
                    <i class="fa fa-sync-alt"></i>
                </button>

                <hr style="margin:15px 0; border-color:rgba(255,255,255,0.1)">

                <h3>All Destinations List</h3>
                <table id="destinations-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Location</th>
                            <th>Image</th>
                            <th>Currency</th>
                            <th>Price</th>
                            <th>Price Range</th>
                            <th>Category</th>
                            <th>Rating</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- GALLERY -->
            <div class="table-wrap view-section" id="gallery" style="display:none">
                <h3 style="margin:0 0 10px">Gallery</h3>
                <div class="form-row">
                    <input id="gallery-image" placeholder="Image URL">
                </div>
                <button class="btn" id="add-gallery">Add Image</button>
                <button class="btn" id="update-gallery">Update Image</button>
                <button class="btn" id="refresh-gallery" title="Refresh">
                    <i class="fa fa-sync-alt"></i>
                </button>

                <hr style="margin:15px 0; border-color:rgba(255,255,255,0.1)">

                <h3>Gallery List</h3>
                <table id="gallery-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Image_URL</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- CONTACT US -->
            <div class="table-wrap view-section" id="contact" style="display:none">

                <h3>All Destinations List</h3>
                <table id="contact-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Subject</th>
                            <th>Message</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

        </main>
    </section>
</div>

<script>
    // Sidebar navigation
    const navItems = document.querySelectorAll("nav li");
    const sections = document.querySelectorAll(".view-section");
    navItems.forEach(item=>{
        item.addEventListener("click",()=>{
            navItems.forEach(i=>i.classList.remove("active"));
            item.classList.add("active");
            const view=item.getAttribute("data-view");
            sections.forEach(sec=>{
                sec.style.display=(sec.id===view)?"block":"none";
            });
        });
    });

    // ================== GLOBAL SEARCH ==================
    const searchInput = document.getElementById("global-search");
    searchInput.addEventListener("input", () => {
        const query = searchInput.value.toLowerCase();

        // function to filter a table by search query
        const filterTable = (tableId) => {
            const table = document.getElementById(tableId);
            const rows = table.querySelectorAll("tbody tr");
            rows.forEach(row => {
                const text = row.innerText.toLowerCase();
                row.style.display = text.includes(query) ? "" : "none";
            });
        };

        // Apply search to all tables
        filterTable("popular-destination-table");
        filterTable("package-table");
        filterTable("destinations-table");
        filterTable("gallery-table");
        filterTable("contact-table");
    });

    // ================== LOAD POPULAR DESTINATIONS ==================
    async function loadDestinations() {
        try {
            const res = await fetch("http://localhost:8080/api/destinations");
            const json = await res.json();

            const destinations = json.data;
            if (!Array.isArray(destinations)) {
                console.error("Expected an array but got:", destinations);
                return;
            }

            const tableBody = document.querySelector("#popular-destination-table tbody");
            tableBody.innerHTML = "";
            destinations.forEach(dest => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${dest.id}</td>
                <td>${dest.title}</td>
                <td>${dest.location}</td>
                <td><img src="${dest.imageUrl}" width="80"></td>
                <td>${dest.duration}</td>
                <td>${dest.currency}</td>
                <td>${dest.price}</td>
                <td>${dest.rating}</td>
                <td>${dest.reviews}</td>
                <td>
                    <button class="update-popDest btn-primary" data-id="${dest.id}">
                        <i class="fa fa-pencil-alt"></i>
                    </button>
                    <button class="delete-popDest btn-danger" data-id="${dest.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            `;
                tableBody.appendChild(tr);
            });

            // Delete Popular Destination
            document.querySelectorAll(".delete-popDest").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/destinations/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadDestinations();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });

            let selectedPdId = null; // global variable

            // When user clicks table "Update" button
            document.addEventListener("click", (e) => {
                if (e.target.classList.contains("update-popDest")) {
                    const row = e.target.closest("tr");
                    selectedPdId = e.target.getAttribute("data-id"); // save the id

                    document.getElementById("pd-title").value = row.children[1].innerText;
                    document.getElementById("pd-location").value = row.children[2].innerText;
                    document.getElementById("pd-image").value = row.children[3].querySelector("img")?.src || "";
                    document.getElementById("pd-duration").value = row.children[4].innerText;
                    document.getElementById("pd-currency").value = row.children[5].innerText;
                    document.getElementById("pd-price").value = row.children[6].innerText;
                    document.getElementById("pd-rating").value = row.children[7].innerText;
                    document.getElementById("pd-reviews").value = row.children[8].innerText;
                }
            });

            // Update button click
            document.getElementById("update-pd").addEventListener("click", async () => {
                if (!selectedPdId) {
                    alert("Please select a row to update first!");
                    return;
                }

                const dto = {
                    title: document.getElementById("pd-title").value,
                    location: document.getElementById("pd-location").value,
                    imageUrl: document.getElementById("pd-image").value,
                    duration: document.getElementById("pd-duration").value,
                    currency: document.getElementById("pd-currency").value,
                    price: parseFloat(document.getElementById("pd-price").value),
                    rating: parseFloat(document.getElementById("pd-rating").value),
                    reviews: parseInt(document.getElementById("pd-reviews").value)
                };

                try {
                    const res = await fetch(`http://localhost:8080/api/destinations/${selectedPdId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(dto)
                    });

                    if (res.ok) {
                        // alert("Updated successfully!");
                        loadDestinations();
                        selectedPdId = null;
                        document.querySelectorAll("#popular-destination input").forEach(i => i.value = "");
                    } else {
                        alert("Failed to update!");
                    }
                } catch (err) {
                    console.error("Update error:", err);
                }
            });
        } catch (err) {
            console.error(err);
        }
        document.querySelectorAll("#popular-destination input").forEach(i => i.value = "");
    }

    document.getElementById("refresh-pd").addEventListener("click", () => {
        document.querySelectorAll("#popular-destination input").forEach(i => i.value = "");
    });

    // ================== LOAD PACKAGES ==================
    async function loadPackages() {
        try {
            const res = await fetch("http://localhost:8080/api/packages");
            const json = await res.json();

            const packages = json.data;
            if (!Array.isArray(packages)) {
                console.error("Expected an array but got:", packages);
                return;
            }

            const tableBody = document.querySelector("#package-table tbody");
            tableBody.innerHTML = "";
            packages.forEach(pkg => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${pkg.id}</td>
                <td>${pkg.title}</td>
                <td>${pkg.tag}</td>
                <td>${pkg.unit}</td>
                <td>${pkg.description}</td>
                <td>${Array.isArray(pkg.features) ? pkg.features.join(", ") : pkg.features}</td>
                <td>${pkg.price}</td>
                <td>
                    <button class="update-pkg btn-primary" data-id="${pkg.id}">
                        <i class="fa fa-pencil-alt"></i>
                    </button>
                    <button class="delete-pkg btn-danger" data-id="${pkg.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            `;
                tableBody.appendChild(tr);
            });

            // Delete Packages
            document.querySelectorAll(".delete-pkg").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/packages/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadPackages();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });

            let selectedPkgId = null;

            // Handle Update click
            document.addEventListener("click", (e) => {
                const btn = e.target.closest(".update-pkg");
                if (btn) {
                    const row = btn.closest("tr");
                    selectedPkgId = btn.getAttribute("data-id");

                    document.getElementById("pkg-title").value = row.children[1].innerText;
                    document.getElementById("pkg-tag").value = row.children[2].innerText;
                    document.getElementById("pkg-unit").value = row.children[3].innerText;
                    document.getElementById("pkg-description").value = row.children[4].innerText;
                    document.getElementById("pkg-features").value = row.children[5].innerText;
                    document.getElementById("pkg-price").value = row.children[6].innerText;
                }
            });

            // Update button click
            document.getElementById("update-package").addEventListener("click", async () => {
                if (!selectedPkgId) {
                    alert("Please select a row to update first!");
                    return;
                }

                const dto = {
                    title: document.getElementById("pkg-title").value,
                    tag: document.getElementById("pkg-tag").value,
                    features: document.getElementById("pkg-features").value
                        .split(",")
                        .map(f => f.trim()),
                    unit: document.getElementById("pkg-unit").value,
                    price: parseFloat(document.getElementById("pkg-price").value) || 0,
                    description: document.getElementById("pkg-description").value
                };

                try {
                    const res = await fetch(`http://localhost:8080/api/packages/${selectedPkgId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(dto)
                    });

                    if (res.ok) {
                        loadPackages();
                        selectedPkgId = null;
                        document.querySelectorAll("#packages input, #packages textarea")
                            .forEach(el => el.value = "");
                    } else {
                        alert("Failed to update!");
                    }
                } catch (err) {
                    console.error("Update error:", err);
                }
            });
        } catch (err) {
            console.error("Error loading packages:", err);
        }
        document.querySelectorAll("#packages input, #packages textarea")
            .forEach(el => el.value = "");
    }

    document.getElementById("refresh-package").addEventListener("click", () => {
        document.querySelectorAll("#packages input, #packages textarea").forEach(i => i.value = "");
    });

    // ================== LOAD ALL DESTINATIONS ==================
    async function loadAllDestinations() {
        try {
            const res = await fetch("http://localhost:8080/api/allDestinations");
            const json = await res.json();

            const destinations = json.data;
            if (!Array.isArray(destinations)) {
                console.error("Expected an array but got:", destinations);
                return;
            }

            const tableBody = document.querySelector("#destinations-table tbody");
            tableBody.innerHTML = "";
            destinations.forEach(dest => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${dest.id}</td>
                <td>${dest.title}</td>
                <td>${dest.location}</td>
                <td><img src="${dest.imageUrl}" width="80"></td>
                <td>${dest.currency || ''}</td>
                <td>${dest.price || ''}</td>
                <td>${dest.priceRange || ''}</td>
                <td>${(dest.category || []).join(", ")}</td>
                <td>${dest.rating || ''}</td>
                <td>
                    <button class="update-allDest btn-primary" data-id="${dest.id}">
                        <i class="fa fa-pencil-alt"></i>
                    </button>
                    <button class="delete-allDest btn-danger" data-id="${dest.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            `;
                tableBody.appendChild(tr);
            });

            // Delete All Destinations
            document.querySelectorAll(".delete-allDest").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/allDestinations/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadAllDestinations();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });

            let selectedADId = null;

            // When user clicks table "Update" button
            document.addEventListener("click", (e) => {
                if (e.target.classList.contains("update-allDest")) {
                    const row = e.target.closest("tr");
                    selectedADId = e.target.getAttribute("data-id");

                    document.getElementById("dest-title").value = row.children[1].innerText;
                    document.getElementById("dest-location").value = row.children[2].innerText;
                    document.getElementById("dest-image").value = row.children[3].querySelector("img")?.src || "";
                    document.getElementById("dest-currency").value = row.children[4].innerText;
                    document.getElementById("dest-price").value = row.children[5].innerText;
                    document.getElementById("dest-priceRange").value = row.children[6].innerText;
                    document.getElementById("dest-category").value = row.children[7].innerText;
                    document.getElementById("dest-rating").value = row.children[8].innerText;
                }
            });

            // Update button click
            document.getElementById("update-destinations").addEventListener("click", async () => {
                if (!selectedADId) {
                    alert("Please select a row to update first!");
                    return;
                }

                const dto = {
                    title: document.getElementById("dest-title").value,
                    location: document.getElementById("dest-location").value,
                    imageUrl: document.getElementById("dest-image").value,
                    currency: document.getElementById("dest-currency").value,
                    price: parseFloat(document.getElementById("dest-price").value) || 0,
                    priceRange: document.getElementById("dest-priceRange").value,
                    category: document.getElementById("dest-category").value.split(",").map(c => c.trim()),
                    rating: parseFloat(document.getElementById("dest-rating").value) || 0
                };

                try {
                    const res = await fetch(`http://localhost:8080/api/allDestinations/${selectedADId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(dto)
                    });

                    if (res.ok) {
                        // alert("Updated successfully!");
                        loadAllDestinations();
                        selectedADId = null;
                        document.querySelectorAll("#destinations input").forEach(i => i.value = "");
                    } else {
                        alert("Failed to update!");
                    }
                } catch (err) {
                    console.error("Update error:", err);
                }
            });
        } catch (err) {
            console.error(err);
        }
        document.querySelectorAll("#destinations input").forEach(i => i.value = "");
    }

    document.getElementById("refresh-destinations").addEventListener("click", () => {
        document.querySelectorAll("#destinations input").forEach(i => i.value = "");
    });

    // ================== LOAD GALLERY ==================
    async function loadGallery() {
        try {
            const res = await fetch("http://localhost:8080/api/galleries");
            const json = await res.json();

            // Ensure json.data is an array
            const galleries = json.data;
            if (!Array.isArray(galleries)) {
                console.error("Expected an array but got:", galleries);
                return;
            }

            const tableBody = document.querySelector("#gallery-table tbody");
            tableBody.innerHTML = "";

            galleries.forEach(gallery => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${gallery.id || ''}</td>
                    <td><img src="${gallery.imageUrl || ''}" width="80"></td>
                    <td>
                    <button class="update-gallery btn-primary" data-id="${gallery.id}">
                        <i class="fa fa-pencil-alt"></i>
                    </button>
                    <button class="delete-gallery btn-danger" data-id="${gallery.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
                `;
                tableBody.appendChild(tr);
            });

            // Delete Gallery
            document.querySelectorAll(".delete-gallery").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/galleries/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadGallery();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });

            let selectedGalleryId = null;

            // When user clicks table "Update" button
            document.addEventListener("click", (e) => {
                if (e.target.classList.contains("update-gallery")) {
                    const row = e.target.closest("tr");
                    selectedGalleryId = e.target.getAttribute("data-id");

                    document.getElementById("gallery-image").value = row.children[1].querySelector("img")?.src || "";
                }
            });

            // Update button click
            document.getElementById("update-gallery").addEventListener("click", async () => {
                if (!selectedGalleryId) {
                    alert("Please select a row to update first!");
                    return;
                }

                const dto = {
                    imageUrl: document.getElementById("gallery-image").value
                };

                try {
                    const res = await fetch(`http://localhost:8080/api/galleries/${selectedGalleryId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(dto)
                    });

                    if (res.ok) {
                        // alert("Updated successfully!");
                        loadGallery();
                        selectedGalleryId = null;
                        document.querySelectorAll("#gallery input").forEach(i => i.value = "");
                    } else {
                        alert("Failed to update!");
                    }
                } catch (err) {
                    console.error("Update error:", err);
                }
            });
        } catch (err) {
            console.error("Error loading gallery:", err);
        }
        document.querySelectorAll("#gallery input").forEach(i => i.value = "");
    }

    document.getElementById("refresh-gallery").addEventListener("click", () => {
        document.querySelectorAll("#gallery input").forEach(i => i.value = "");
    });

    // ================== LOAD CONTACT ==================
    async function loadContact() {
        try {
            const res = await fetch("http://localhost:8080/api/contacts");
            const json = await res.json();

            const contacts = json.data;
            if (!Array.isArray(contacts)) {
                console.error("Expected an array but got:", contacts);
                return;
            }

            const tableBody = document.querySelector("#contact-table tbody");
            tableBody.innerHTML = "";

            contacts.forEach(contact => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${contact.id || ''}</td>
                <td>${contact.name || ''}</td>
                <td>${contact.email || ''}</td>
                <td>${contact.subject || ''}</td>
                <td>${contact.message || ''}</td>
                <td>
                    <button class="delete-contact btn-danger" data-id="${contact.id}">
                        <i class="fa fa-trash"></i>
                    </button>
                </td>
            `;
                tableBody.appendChild(tr);
            });

            // Delete Contact
            document.querySelectorAll(".delete-contact").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.getAttribute("data-id");
                    if (!confirm("Are you sure you want to delete this?")) return;

                    try {
                        const res = await fetch(`http://localhost:8080/api/contacts/${id}`, {
                            method: "DELETE"
                        });
                        if (res.ok) {
                            loadContact();
                            alert("Deleted successfully!");
                        } else {
                            alert("Failed to delete!");
                        }
                    } catch (err) {
                        console.error("Delete error:", err);
                    }
                });
            });
        } catch (err) {
            console.error("Error loading contacts:", err);
        }
    }


    // ----------------------Data Saving----------------------
    // ================== POPULAR DESTINATIONS ==================
    document.getElementById("add-pd").addEventListener("click", async () => {
        const dto = {
            title: document.getElementById("pd-title").value,
            location: document.getElementById("pd-location").value,
            imageUrl: document.getElementById("pd-image").value,
            duration: document.getElementById("pd-duration").value,
            currency: document.getElementById("pd-currency").value,
            price: parseFloat(document.getElementById("pd-price").value),
            rating: parseFloat(document.getElementById("pd-rating").value),
            reviews: parseInt(document.getElementById("pd-reviews").value)
        };

        try {
            const res = await fetch("http://localhost:8080/api/destinations", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dto)
            });

            if (res.ok) {
                alert("Popular Destination save is successful!");
                loadDestinations();
            } else {
                alert("Popular Destination save is failed!");
            }
        } catch (err) {
            console.error(err);
        }

        //input clear
        document.querySelectorAll("#popular-destination input").forEach(i => i.value = "");
    });

    // ================== PACKAGES ==================
    document.getElementById("add-package").addEventListener("click", async () => {
        const dto = {
            title: document.getElementById("pkg-title").value,
            tag: document.getElementById("pkg-tag").value,
            features: document.getElementById("pkg-features").value
                .split(",")
                .map(f => f.trim()),  // comma separated features
            unit: document.getElementById("pkg-unit").value,
            price: parseFloat(document.getElementById("pkg-price").value) || 0,
            description: document.getElementById("pkg-description").value
        };

        try {
            const res = await fetch("http://localhost:8080/api/packages", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dto)
            });

            if (res.ok) {
                alert("Package save is successful!");
                loadPackages();
            } else {
                alert("Package save is failed!");
            }
        } catch (err) {
            console.error("Error saving package:", err);
        }

        // input clear
        document.querySelectorAll("#packages input").forEach(i => i.value = "");
    });

    // ================== ADD ALL DESTINATIONS ==================
    document.getElementById("add-destinations").addEventListener("click", async () => {
        const dto = {
            title: document.getElementById("dest-title").value,
            location: document.getElementById("dest-location").value,
            imageUrl: document.getElementById("dest-image").value,
            currency: document.getElementById("dest-currency").value,
            price: parseFloat(document.getElementById("dest-price").value) || 0,
            priceRange: document.getElementById("dest-priceRange").value,
            category: document.getElementById("dest-category").value.split(",").map(c => c.trim()),
            rating: parseFloat(document.getElementById("dest-rating").value) || 0
        };

        try {
            const res = await fetch("http://localhost:8080/api/allDestinations", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dto)
            });

            if (res.ok) {
                alert("Destination save is successful!");
                loadAllDestinations();
            } else {
                alert("Destination save is failed!");
            }
        } catch (err) {
            console.error(err);
        }

        //input clear
        document.querySelectorAll("#destinations input").forEach(i => i.value = "");
    });

    // ================== ADD GALLERY IMAGE ==================
    document.getElementById("add-gallery").addEventListener("click", async () => {
        const dto = {
            imageUrl: document.getElementById("gallery-image").value
        };

        try {
            const res = await fetch("http://localhost:8080/api/galleries", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dto)
            });

            if (res.ok) {
                alert("Gallery image added successfully!");
                loadGallery();
            } else {
                alert("Failed to add gallery image!");
            }
        } catch (err) {
            console.error("Error saving gallery image:", err);
        }

        // Clear input
        document.getElementById("gallery-image").value = "";
    });

    // ================== INITIAL LOAD ==================
    window.addEventListener("DOMContentLoaded", () => {
        loadDestinations();
        loadPackages();
        loadAllDestinations();
        loadGallery();
        loadContact();

        // ===== Auth check (inside DOMContentLoaded) =====
        const token = getCookie("token");
        if (!token) {
            // toastr.warning("You must be logged in.", "Access Denied");
            setTimeout(() => window.location.href = "login.html", 1500);
        }
    });

    // ===== Cookie Helpers (GLOBAL scope) =====
    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i].trim();
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function deleteCookie(name) {
        document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax;";
    }

    // ===== Logout (GLOBAL so button onclick works) =====
    function logout() {
        deleteCookie("token");
        deleteCookie("username");
        // toastr.info("Logged out successfully.", "Logout");
        setTimeout(() => window.location.href = "index.html", 1500);
    }
</script>
</body>
</html>