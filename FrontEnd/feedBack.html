<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FeedBack - Trip.com</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="css/feedBack.css">
    <link rel="stylesheet" href="css/toastr.css">
</head>
<body>
<!-- Preloader
<div class="preloader">
    <div class="preloader-spinner"></div>
</div>-->
<!-- Header -->
<header class="header">
    <div class="container">
        <div class="header-inner">
            <div class="logo">
                <a href="home.html" class="logo-link">
                    <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="3 11 22 2 13 21 11 13 3 11"/>
                    </svg>
                    <span class="logo-text">Trip</span> <span class="logo-sub">.com</span>
                </a>
            </div>
            <nav class="nav">
                <ul class="nav-list">
                    <li><a href="home.html">Home</a></li>
                    <li><a href="destination.html">Destinations</a></li>
                    <li><a href="guides.html">Guides</a></li>
<!--                    <li><a href="universities.html">Universities</a></li>-->
                    <li><a href="vehicle.html" class="active">Vehicle Rentals</a></li>
                    <li><a href="feedBack.html">FeedBack</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <!--        <button class="btn btn-outline" onclick="window.location.href= 'login.html'">Book Now</button>-->
                <button class="btn-logout" onclick="logout()">Logout</button>
                <button class="menu-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<main>
    <!-- Page Header -->
    <section class="page-header" id="destinations">
        <div class="page-header-bg">
            <div class="page-header-overlay"></div>
        </div>
        <div class="container">
            <div class="page-header-content">
                <h1 class="page-title split-text">FeedBack</h1>
                <div class="breadcrumbs">
                    <a href="home.html" class="breadcrumb-item">Home</a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-item active">FeedBack</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Fullscreen Feedback Form Section -->
    <section id="feedback" class="feedback-section-fullscreen">
        <div class="feedback-container">
            <form class="feedback-form" action="#" method="POST">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Your Name</label>
                        <input type="text" id="name" name="name" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Your Email</label>
                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="trip">Trip Name</label>
                        <input type="text" id="trip" name="trip" placeholder="Which trip did you take?" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="message">Your Feedback</label>
                    <textarea id="message" name="message" rows="3" placeholder="Share your experience..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Submit Feedback</button>
            </form>
        </div>
    </section>
</main>



<!-- jQuery (must be before toastr) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Toastr CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<!-- Toastr JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const feedbackForm = document.querySelector(".feedback-form");

        if (feedbackForm) {
            feedbackForm.addEventListener("submit", async (e) => {
                e.preventDefault();

                // Collect input values
                const feedback = {
                    name: document.getElementById("name").value,
                    email: document.getElementById("email").value,
                    trip: document.getElementById("trip").value,
                    message: document.getElementById("message").value
                };

                try {
                    const response = await fetch("http://localhost:8080/api/feedback", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${token}`
                        },
                        body: JSON.stringify(feedback)
                    });

                    const result = await response.json();

                    if (response.ok) {
                        toastr.success(result.message || "✅ Feedback submitted successfully!", "Success");
                        feedbackForm.reset();
                    } else {
                        toastr.error(result.message || "Failed to submit feedback.", "❌ Error");
                    }
                } catch (error) {
                    console.error("Error submitting feedback:", error);
                    toastr.error("⚠️ Failed to connect to server.", "Network Error");
                }
            });
        }

        // ===== Auth check (inside DOMContentLoaded) =====
        const token = getCookie("token");
        if (!token) {
            toastr.warning("You must be logged in to submit feedback.", "Access Denied");
            setTimeout(() => window.location.href = "login.html", 1500);
            // return; // stop further execution
        }
    });

    // ===== Cookie Helpers (GLOBAL scope) =====
    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i].trim();
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function deleteCookie(name) {
        document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax;";
    }

    // ===== Logout (GLOBAL so button onclick works) =====
    function logout() {
        deleteCookie("token");
        deleteCookie("username");
        toastr.info("Logged out successfully.", "Logout");
        setTimeout(() => window.location.href = "index.html", 1500);
    }

    // Toastr settings (optional customization)
    toastr.options = {
        "closeButton": true,
        "progressBar": true,
        "positionClass": "toast-top-right",
        "timeOut": "4000"
    };
</script>
</body>
</html>